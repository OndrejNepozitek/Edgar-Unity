"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3599],{603905:function(e,t,r){r.d(t,{Zo:function(){return m},kt:function(){return u}});var o=r(667294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var s=o.createContext({}),c=function(e){var t=o.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},m=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},p=o.forwardRef((function(e,t){var r=e.components,n=e.mdxType,a=e.originalType,s=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),p=c(r),u=n,h=p["".concat(s,".").concat(u)]||p[u]||d[u]||a;return r?o.createElement(h,l(l({ref:t},m),{},{components:r})):o.createElement(h,l({ref:t},m))}));function u(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var a=r.length,l=new Array(a);l[0]=p;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:n,l[1]=i;for(var c=2;c<a;c++)l[c]=r[c];return o.createElement.apply(null,l)}return o.createElement.apply(null,r)}p.displayName="MDXCreateElement"},222960:function(e,t,r){r.r(t),r.d(t,{frontMatter:function(){return i},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return m},default:function(){return f}});var o=r(487462),n=r(263366),a=(r(667294),r(603905)),l=["components"],i={title:"Current room detection"},s=void 0,c={unversionedId:"guides/current-room-detection",id:"version-2.0.2/guides/current-room-detection",title:"Current room detection",description:"In this guide, we will learn how to detect when a player enters or leaves a room. We can use this information to keep track of the currently active room, or we can for example spawn enemies when the player enters a room.",source:"@site/versioned_docs/version-2.0.2/guides/current-room-detection.md",sourceDirName:"guides",slug:"/guides/current-room-detection",permalink:"/Edgar-Unity/docs/2.0.2/guides/current-room-detection",editUrl:"https://github.com/OndrejNepozitek/Edgar-Unity/tree/docusaurus/versioned_docs/version-2.0.2/guides/current-room-detection.md",tags:[],version:"2.0.2",frontMatter:{title:"Current room detection"},sidebar:"docs",previous:{title:"Room template customization",permalink:"/Edgar-Unity/docs/2.0.2/guides/room-template-customization"},next:{title:"(PRO) Fog of war",permalink:"/Edgar-Unity/docs/2.0.2/guides/fog-of-war"}},m=[{value:"Setup",id:"setup",children:[],level:2},{value:"Floor collider",id:"floor-collider",children:[],level:2},{value:"Trigger handler",id:"trigger-handler",children:[],level:2},{value:"Room manager",id:"room-manager",children:[],level:2},{value:"Game manager",id:"game-manager",children:[],level:2}],d=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,a.kt)("div",t)}},p=d("Image"),u=d("Path"),h=d("ExternalCode"),g={toc:m};function f(e){var t=e.components,r=(0,n.Z)(e,l);return(0,a.kt)("wrapper",(0,o.Z)({},g,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"In this guide, we will learn how to detect when a player enters or leaves a room. We can use this information to keep track of the currently active room, or we can for example spawn enemies when the player enters a room."),(0,a.kt)(p,{src:"2d/guides/current_room_detection/result.png",caption:"Information about the current room are displayed in the top-left corner.",mdxType:"Image"}),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("strong",{parentName:"p"},"Note:")," All files from this example can be found at ",(0,a.kt)(u,{path:"2de:CurrentRoomDetection",mdxType:"Path"}),".")),(0,a.kt)("h2",{id:"setup"},"Setup"),(0,a.kt)("p",null,"Our plan is the following:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Add a ",(0,a.kt)("strong",{parentName:"li"},"trigger collider")," to the ",(0,a.kt)("strong",{parentName:"li"},"floor tilemap")," layer of individual room templates"),(0,a.kt)("li",{parentName:"ul"},"Add a ",(0,a.kt)("strong",{parentName:"li"},"RoomManager")," component that will react to the ",(0,a.kt)("strong",{parentName:"li"},"player entering or leaving the room")),(0,a.kt)("li",{parentName:"ul"},"Add a ",(0,a.kt)("em",{parentName:"li"},"handler")," that will react to the ",(0,a.kt)("strong",{parentName:"li"},"OnTriggerEnter2D")," and ",(0,a.kt)("strong",{parentName:"li"},"OnTriggerExit2D")," events and delegate that to the room manager"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("em",{parentName:"li"},"(Optional)")," Add a ",(0,a.kt)("strong",{parentName:"li"},"GameManager")," component that will display the ",(0,a.kt)("strong",{parentName:"li"},"currently active room"))),(0,a.kt)("p",null,"We will use the room templates from ",(0,a.kt)("a",{parentName:"p",href:"/Edgar-Unity/docs/2.0.2/examples/example-1"},"Example 1")," and the following level graph:"),(0,a.kt)(p,{src:"2d/guides/current_room_detection/level_graph.png",caption:"The level graph that is used in this guide. Each room has a unique name so that we can easily recognize if our implementation works or not.",mdxType:"Image"}),(0,a.kt)("h2",{id:"floor-collider"},"Floor collider"),(0,a.kt)("p",null,"We will use a trigger collider attached to the floor layer of individual room templates to detect when a player enters or leaves a room. There are at least two ways of adding this collider:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"We can ",(0,a.kt)("a",{parentName:"li",href:"/Edgar-Unity/docs/2.0.2/guides/room-template-customization"},"override the default structure of tilemaps")," in order to add the floor collider to each room template right after it is created."),(0,a.kt)("li",{parentName:"ol"},"We can use a custom post-processing script to add the floor collider to each room after a level is generated.")),(0,a.kt)("p",null,"An advantage of the first approach is that Unity does not have to recompute the colliders every time a level is generated. An advantage of the second approach is that it is more flexible and easier to experiment with because we can just write a simple post-processing script a do not have to modify any room templates. We decided to use the second approach because we use a room template from ",(0,a.kt)("a",{parentName:"p",href:"/Edgar-Unity/docs/2.0.2/examples/example-1"},"Example 1"),", and they do not have any floor colliders."),(0,a.kt)("p",null,"Below you can see the post-processing code that is needed to add this floor collider to each of the rooms in a generated level."),(0,a.kt)(h,{name:"2d_currentRoomDetection_postProcessing_1",mdxType:"ExternalCode"}),(0,a.kt)("h2",{id:"trigger-handler"},"Trigger handler"),(0,a.kt)("p",null,"When we have our floor colliders enabled, we must be able to do something when the player triggers the collider. We will create a very simple component that will be added the floor tilemap layer. This component will have two methods - ",(0,a.kt)("strong",{parentName:"p"},"OnTriggerEnter2D")," and ",(0,a.kt)("strong",{parentName:"p"},"OnTriggerExit2D")," - and inside these methods we will call the room manager that we will create in the next step."),(0,a.kt)(h,{name:"2d_currentRoomDetection_triggerHandler",mdxType:"ExternalCode"}),(0,a.kt)("p",null,"We have to add this component to each room in the generated level. We will modify our post-processing logic to look like this:"),(0,a.kt)(h,{name:"2d_currentRoomDetection_postProcessing_2",mdxType:"ExternalCode"}),(0,a.kt)("h2",{id:"room-manager"},"Room manager"),(0,a.kt)("p",null,"We could handle all the logic inside the handler that we created in the previous step. However, it might be better to have a central place where all the logic regarding individual rooms takes place. Therefore, we will create a simple room manager component with two methods - ",(0,a.kt)("strong",{parentName:"p"},"OnRoomEnter")," and ",(0,a.kt)("strong",{parentName:"p"},"OnRoomLeave")," which will be called by the handler from the previous step."),(0,a.kt)(h,{name:"2d_currentRoomDetection_roomManager",mdxType:"ExternalCode"}),(0,a.kt)("p",null,"Again, we will use our post-processing logic to add this room manager to each room in the level. Moreover, we will also set the ",(0,a.kt)("inlineCode",{parentName:"p"},"RoomInstance")," field so that the room manager has access to all the information about the room."),(0,a.kt)(h,{name:"2d_currentRoomDetection_postProcessing_3",mdxType:"ExternalCode"}),(0,a.kt)("h2",{id:"game-manager"},"Game manager"),(0,a.kt)("p",null,"The last thing that we can do is to add a game manager that will keep track of in which room the player is currently located. A straightforward solution would be to simply keep track of which room was entered most recently. However, there is a catch. The player collider might be quite large, so it is possible that it collides with two neighbouring rooms at once. That means that if the player goes just slightly to the next room and then back to the previous room, ",(0,a.kt)("inlineCode",{parentName:"p"},"OnTriggerEnter2D")," will not be called because the player did not leave the room."),(0,a.kt)("p",null,"The solution is quite simple. We will set the new room to be active only when the player completely leaves the current room. An example implementation can be seen in the game manager class that is included in the folder with the example."))}f.isMDXComponent=!0}}]);